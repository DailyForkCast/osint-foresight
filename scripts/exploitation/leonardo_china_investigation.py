#!/usr/bin/env python3
"""
Leonardo-China Connection Investigation
Identifies potential Chinese exploitation pathways through Leonardo/Italy to US technology
"""

import json
from datetime import datetime
from pathlib import Path
import urllib.parse

OUTPUT_DIR = Path("C:/Projects/OSINT - Foresight/data/processed/italy_china_us")
OUTPUT_DIR.mkdir(parents=True, exist_ok=True)

def generate_leonardo_china_queries():
    """Generate comprehensive search queries for Leonardo-China connections."""

    queries = {
        "high_priority": {
            "leonardo_direct": [
                'Leonardo S.p.A. China contract',
                'Leonardo Beijing office',
                'Leonardo Shanghai',
                'Leonardo Finmeccanica China',  # Historical name
                'Leonardo Chinese customer',
                'Leonardo AVIC partnership',  # Aviation Industry Corporation of China
                'Leonardo NORINCO',  # China North Industries
                'Leonardo Huawei',
                'Leonardo ZTE'
            ],
            "leonardo_drs_risk": [
                'Leonardo DRS China',
                'DRS Technologies China',
                'Leonardo DRS cyber attack China',
                'Leonardo DRS technology transfer',
                'Leonardo DRS ITAR violation'
            ],
            "italy_bri": [
                'Italy Belt and Road technology',
                'Italy BRI withdrawal 2024',  # Italy left BRI in 2024
                'Italian technology China investment',
                'Italy China innovation fund',
                'Sino-Italian technology park'
            ]
        },
        "technology_specific": {
            "night_vision": [
                'China night vision Italy',
                'Chinese thermal imaging Leonardo',
                'FLIR technology China Italy',
                'Infrared sensor China Leonardo'
            ],
            "aerospace": [
                'Leonardo helicopter China',
                'AgustaWestland China',  # Leonardo subsidiary
                'Italian aerospace China joint venture',
                'China Italy satellite cooperation'
            ],
            "defense_electronics": [
                'Leonardo radar China',
                'Italian defense electronics China',
                'Selex ES China',  # Former Leonardo subsidiary
                'Electronic warfare Italy China'
            ]
        },
        "personnel_movement": {
            "talent_programs": [
                'Leonardo employee Thousand Talents',
                'Italian researcher China recruitment',
                'Leonardo scientist Chinese university',
                'Italy China talent exchange'
            ],
            "academic": [
                'Politecnico Milano Chinese partnership',
                'Sapienza University China collaboration',
                'Italian Chinese joint laboratory',
                'China Scholarship Council Italy'
            ]
        },
        "investment_patterns": {
            "chinese_capital": [
                'Chinese investment Italian defense',
                'China Italian technology acquisition',
                'Silk Road Fund Italy technology',
                'Chinese private equity Italy aerospace'
            ],
            "joint_ventures": [
                'Sino-Italian joint venture defense',
                'China Italy technology company',
                'Italian Chinese manufacturing',
                'China Italy industrial cooperation'
            ]
        },
        "cyber_intelligence": {
            "apt_groups": [
                'APT China Leonardo',
                'Chinese hackers Italian defense',
                'Leonardo cyber attack attribution',
                'Italy defense industry China cyber'
            ],
            "technology_theft": [
                'Leonardo intellectual property China',
                'Italian technology theft China',
                'Industrial espionage Italy China',
                'Leonardo trade secret China'
            ]
        }
    }

    return queries

def create_collection_plan():
    """Create structured collection plan for Leonardo-China investigation."""

    plan = {
        "phase_1_immediate": {
            "timeframe": "24-48 hours",
            "tasks": [
                {
                    "task": "Leonardo S.p.A. China footprint",
                    "sources": ["Company website", "Annual reports", "Press releases"],
                    "queries": ["Leonardo China office", "Leonardo Chinese contracts"],
                    "output": "leonardo_china_presence.json"
                },
                {
                    "task": "BRI participation check",
                    "sources": ["Italian government sites", "EU databases", "BRI official lists"],
                    "queries": ["Italy Belt and Road MOU", "Leonardo BRI projects"],
                    "output": "italy_bri_status.json"
                },
                {
                    "task": "Chinese investment scan",
                    "sources": ["CFIUS reports", "EU FDI screening", "Financial databases"],
                    "queries": ["Chinese investment Leonardo", "China Italian defense M&A"],
                    "output": "chinese_investment_italy_defense.json"
                }
            ]
        },
        "phase_2_near_term": {
            "timeframe": "3-7 days",
            "tasks": [
                {
                    "task": "Personnel movement analysis",
                    "sources": ["LinkedIn", "ResearchGate", "ORCID", "Google Scholar"],
                    "queries": ["Leonardo employee China", "Italian researcher Chinese university"],
                    "output": "personnel_flows.json"
                },
                {
                    "task": "Technology overlap mapping",
                    "sources": ["Patent databases", "Research papers", "Conference proceedings"],
                    "queries": ["Leonardo patent China cite", "Sino-Italian defense research"],
                    "output": "technology_overlaps.json"
                },
                {
                    "task": "Supply chain investigation",
                    "sources": ["Trade databases", "Customs records", "Industry reports"],
                    "queries": ["Leonardo supplier China", "Chinese components Italian defense"],
                    "output": "supply_chain_china_exposure.json"
                }
            ]
        },
        "phase_3_deep_dive": {
            "timeframe": "1-2 weeks",
            "tasks": [
                {
                    "task": "Network analysis",
                    "sources": ["Corporate registries", "Conference attendee lists", "Joint publications"],
                    "queries": ["Leonardo China conference", "Sino-Italian defense forum"],
                    "output": "relationship_network.json"
                },
                {
                    "task": "Risk assessment",
                    "sources": ["Intelligence reports", "Think tank analysis", "Academic studies"],
                    "queries": ["China Italy technology transfer risk", "Leonardo security concerns"],
                    "output": "risk_assessment.json"
                }
            ]
        }
    }

    return plan

def generate_risk_indicators():
    """Generate specific risk indicators for Leonardo-China connections."""

    indicators = {
        "red_flags": [
            {
                "indicator": "Leonardo subsidiary in China",
                "risk_level": "HIGH",
                "implication": "Direct technology transfer pathway",
                "collection_action": "Check Leonardo Beijing/Shanghai offices"
            },
            {
                "indicator": "Chinese investment in Leonardo supplier",
                "risk_level": "HIGH",
                "implication": "Supply chain compromise",
                "collection_action": "Map Leonardo supplier ownership"
            },
            {
                "indicator": "Leonardo employee in Thousand Talents Program",
                "risk_level": "CRITICAL",
                "implication": "Direct intelligence collection",
                "collection_action": "Search talent program databases"
            },
            {
                "indicator": "Joint research with Chinese military university",
                "risk_level": "CRITICAL",
                "implication": "Dual-use technology transfer",
                "collection_action": "Check publication databases"
            },
            {
                "indicator": "Leonardo technology in Chinese military system",
                "risk_level": "CRITICAL",
                "implication": "Successful technology acquisition",
                "collection_action": "Compare system specifications"
            }
        ],
        "yellow_flags": [
            {
                "indicator": "Italian university with Leonardo and Chinese partnerships",
                "risk_level": "MEDIUM",
                "implication": "Indirect access pathway",
                "collection_action": "Map university relationships"
            },
            {
                "indicator": "Leonardo participation in China trade show",
                "risk_level": "MEDIUM",
                "implication": "Technology exposure",
                "collection_action": "Review trade show materials"
            },
            {
                "indicator": "Chinese nationals at Leonardo Italian facilities",
                "risk_level": "MEDIUM",
                "implication": "Insider threat potential",
                "collection_action": "LinkedIn employee analysis"
            }
        ],
        "monitoring_triggers": [
            "New Leonardo contract in Asia-Pacific",
            "Chinese acquisition attempt of Italian defense firm",
            "Cyber attack on Leonardo attributed to China",
            "Joint Italy-China technology initiative",
            "Leonardo executive travel to China"
        ]
    }

    return indicators

def create_search_urls():
    """Create ready-to-use search URLs for immediate investigation."""

    base_urls = {
        "google": "https://www.google.com/search?q=",
        "google_scholar": "https://scholar.google.com/scholar?q=",
        "linkedin": "https://www.linkedin.com/search/results/all/?keywords=",
        "patents": "https://patents.google.com/?q=",
        "github": "https://github.com/search?q="
    }

    priority_searches = [
        {
            "description": "Leonardo China offices",
            "google": base_urls["google"] + urllib.parse.quote('"Leonardo" ("Beijing" OR "Shanghai" OR "Shenzhen") office'),
            "linkedin": base_urls["linkedin"] + urllib.parse.quote("Leonardo China")
        },
        {
            "description": "Leonardo-AVIC cooperation",
            "google": base_urls["google"] + urllib.parse.quote('"Leonardo" "AVIC" (partnership OR cooperation OR agreement)'),
            "patents": base_urls["patents"] + urllib.parse.quote("assignee:Leonardo AND China")
        },
        {
            "description": "Italy BRI technology",
            "google": base_urls["google"] + urllib.parse.quote('"Belt and Road" Italy technology (Leonardo OR Finmeccanica)'),
            "scholar": base_urls["google_scholar"] + urllib.parse.quote("Italy China technology cooperation")
        },
        {
            "description": "Chinese investment Italian defense",
            "google": base_urls["google"] + urllib.parse.quote('Chinese investment "Italian defense" (Leonardo OR aerospace)'),
            "linkedin": base_urls["linkedin"] + urllib.parse.quote("Chinese Italian defense")
        }
    ]

    return priority_searches

def create_intelligence_requirements():
    """Define specific intelligence requirements for Leonardo-China investigation."""

    requirements = {
        "priority_intelligence_requirements": [
            {
                "pir": "Does Leonardo have any direct contracts with Chinese entities?",
                "indicators": ["Contract announcements", "Annual report disclosures", "Trade show materials"],
                "significance": "Direct technology transfer pathway"
            },
            {
                "pir": "Are there Chinese nationals in sensitive positions at Leonardo?",
                "indicators": ["LinkedIn profiles", "Research papers", "Patent filings"],
                "significance": "Insider threat and intelligence collection"
            },
            {
                "pir": "Has China attempted to acquire Leonardo or its subsidiaries?",
                "indicators": ["M&A databases", "CFIUS filings", "EU screening reports"],
                "significance": "Strategic technology acquisition"
            },
            {
                "pir": "What Leonardo technologies appear in Chinese military systems?",
                "indicators": ["System specifications", "Patent citations", "Technical similarities"],
                "significance": "Successful technology transfer"
            }
        ],
        "specific_information_requirements": [
            "Leonardo revenue from China/Asia-Pacific",
            "Number of Chinese nationals employed by Leonardo globally",
            "Leonardo patents cited by Chinese entities",
            "Joint publications between Leonardo and Chinese researchers",
            "Leonardo participation in Chinese trade shows/conferences",
            "Chinese cyber attacks targeting Leonardo",
            "Leonardo technology export licenses to China",
            "Italian government position on Leonardo-China business"
        ],
        "essential_elements_of_information": [
            {
                "eei": "Leonardo China exposure level",
                "metrics": ["Revenue %", "Employee %", "Partnership count"],
                "threshold": "Any revenue >5% or employees >10 or partnerships >0"
            },
            {
                "eei": "Technology transfer risk",
                "metrics": ["Dual-use technologies", "Export violations", "Similar Chinese systems"],
                "threshold": "Any confirmed transfer or violation"
            },
            {
                "eei": "Supply chain vulnerability",
                "metrics": ["Chinese suppliers", "Critical components", "Single sources"],
                "threshold": "Any critical component from China"
            }
        ]
    }

    return requirements

def save_investigation_package():
    """Save complete investigation package for Leonardo-China connections."""

    package = {
        "generated": datetime.now().isoformat(),
        "investigation": "Leonardo-China-US Technology Triangle",
        "priority": "CRITICAL",
        "queries": generate_leonardo_china_queries(),
        "collection_plan": create_collection_plan(),
        "risk_indicators": generate_risk_indicators(),
        "search_urls": create_search_urls(),
        "intelligence_requirements": create_intelligence_requirements(),
        "next_steps": [
            "Execute Phase 1 searches immediately",
            "Check Leonardo annual reports for China disclosure",
            "Search LinkedIn for Leonardo employees in China",
            "Review patent databases for Leonardo-China connections",
            "Check cyber threat intelligence for Leonardo targeting"
        ]
    }

    # Save main package
    output_file = OUTPUT_DIR / "leonardo_china_investigation_package.json"
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(package, f, indent=2)

    print(f"[OK] Investigation package saved to: {output_file}")

    # Create quick reference guide
    create_quick_reference(package)

    return package

def create_quick_reference(package):
    """Create a quick reference guide for immediate action."""

    guide = f"""# Leonardo-China Investigation: Quick Reference

*Generated: {datetime.now().strftime('%Y-%m-%d %H:%M')}*

## IMMEDIATE ACTIONS (Next 2 Hours)

### 1. Check Leonardo China Presence
- Search: "Leonardo Beijing office" OR "Leonardo Shanghai"
- Check Leonardo annual report for China revenue
- LinkedIn: Search employees at "Leonardo China"

### 2. BRI Participation
- Search: "Leonardo Belt and Road"
- Check: Italy BRI status (withdrew 2024)
- Look for: Ongoing projects despite withdrawal

### 3. Investment Scan
- Search: "Chinese investment Leonardo"
- Check: CFIUS/CIFIUS reports
- Look for: Minority stakes, joint ventures

## HIGH-RISK INDICATORS TO WATCH

### CRITICAL (Immediate Investigation)
- Leonardo subsidiary in China
- Chinese military university collaboration
- Thousand Talents Program participation
- Leonardo tech in Chinese military systems

### HIGH (Within 24 Hours)
- Chinese investment in Leonardo suppliers
- Joint research programs
- Technology licensing to China
- Cyber attacks from China

## SEARCH QUERIES TO RUN NOW

### Google:
```
"Leonardo" "China" (contract OR partnership OR agreement)
"Leonardo SpA" (Beijing OR Shanghai OR Shenzhen)
"Leonardo" "AVIC" aerospace
"Leonardo" "Belt and Road"
"Leonardo DRS" China
```

### LinkedIn:
```
Current Company: Leonardo
Location: China
---
Past Company: Leonardo
Current Company: (Chinese company)
---
Leonardo "Thousand Talents"
```

### Patent Databases:
```
Assignee: Leonardo
Inventor country: China
---
Assignee: (Chinese entity)
Citation: Leonardo patent
```

## KEY ENTITIES TO INVESTIGATE

### Chinese Companies to Check:
- AVIC (Aviation Industry Corporation)
- NORINCO (China North Industries)
- CETC (China Electronics Technology)
- Huawei
- ZTE

### Italian Entities at Risk:
- Leonardo S.p.A. (parent)
- Leonardo DRS (US subsidiary)
- AgustaWestland (helicopters)
- Selex ES (electronics)
- OTO Melara (naval systems)

## TECHNOLOGY AREAS OF CONCERN

### Highest Risk:
1. Night vision/thermal imaging
2. Electronic warfare systems
3. Radar technology
4. Helicopter systems
5. Naval weapons

### Dual-Use Concerns:
1. Quantum sensing
2. AI/ML algorithms
3. Advanced materials
4. Satellite technology
5. Cybersecurity tools

## INTELLIGENCE GAPS TO FILL

1. **Direct Contracts**: Any Leonardo contracts with Chinese entities?
2. **Personnel**: Chinese nationals in sensitive Leonardo positions?
3. **Investment**: Chinese stakes in Leonardo or suppliers?
4. **Technology Transfer**: Leonardo tech in Chinese systems?
5. **Cyber**: Chinese APT targeting of Leonardo?

## BOTTOM LINE

**Every Leonardo connection to China represents a potential pathway for US technology compromise through the Italian subsidiary Leonardo DRS.**

Focus on:
- Direct Leonardo-China business relationships
- Indirect access through Italian research institutions
- Supply chain vulnerabilities
- Personnel with dual loyalties
- Technology that has already transferred

---

**Time Requirement**: 2-4 hours for initial scan
**Priority**: CRITICAL - Leonardo DRS has 14,514 US defense contracts
**Risk**: US military technology accessible to China through Italy
"""

    guide_file = OUTPUT_DIR / "LEONARDO_CHINA_QUICK_REFERENCE.md"
    with open(guide_file, 'w', encoding='utf-8') as f:
        f.write(guide)

    print(f"[OK] Quick reference guide saved to: {guide_file}")

if __name__ == "__main__":
    print("=" * 60)
    print("LEONARDO-CHINA CONNECTION INVESTIGATION")
    print("=" * 60)

    # Generate and save investigation package
    package = save_investigation_package()

    print("\n" + "=" * 40)
    print("IMMEDIATE SEARCH PRIORITIES")
    print("=" * 40)

    # Display immediate actions
    for task in package['collection_plan']['phase_1_immediate']['tasks']:
        print(f"\n{task['task']}:")
        print(f"  Sources: {', '.join(task['sources'])}")
        print(f"  Output: {task['output']}")

    print("\n" + "=" * 40)
    print("CRITICAL RISK INDICATORS")
    print("=" * 40)

    # Display red flags
    for flag in package['risk_indicators']['red_flags'][:3]:
        print(f"\n{flag['indicator']}:")
        print(f"  Risk: {flag['risk_level']}")
        print(f"  Action: {flag['collection_action']}")

    print("\n" + "=" * 40)
    print("READY-TO-USE SEARCHES")
    print("=" * 40)

    # Display search URLs
    for search in package['search_urls'][:3]:
        print(f"\n{search['description']}:")
        print(f"  Google: {search.get('google', 'N/A')[:80]}...")

    print("\n[OK] Investigation package ready for execution")
    print(f"[OK] Files saved to: {OUTPUT_DIR}")
    print("\n‚è±Ô∏è Estimated time for Phase 1: 2-4 hours")
    print("üéØ Focus: China's access to US technology through Leonardo/Italy")
    print("‚ö†Ô∏è Priority: CRITICAL - 14,514 US contracts at risk")
